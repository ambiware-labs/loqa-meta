# RFC-0003: Loqa Marketplace MVP

- **Status:** Draft
- **Authors:** Anna Barnes, Loqa Labs Team
- **Created:** 2025-09-28
- **Target Release:** Workstream F – Ecosystem Foundations
- **Discussion:** https://github.com/loqalabs/loqa-meta/issues/26

## Summary
Establish the first iteration of the Loqa Marketplace: a lightweight distribution channel for skills and adapters that complements the open-core runtime. The MVP will define the package format, metadata requirements, signing model, and the minimal services/CLI needed to discover, install, and update skills while preserving Loqa’s local-first ethos.

## Motivation
- **Problem:** Skills are currently shared ad hoc via source repos. Operators lack a curated catalog, and creators lack a clear submission and update path.
- **Goals:**
  - Provide a discoverable catalog of Loqa-compatible skills with metadata that matches the v1 manifest spec.
  - Enable scripted installation/upgrade workflows that respect offline/local-only deployments.
  - Lay the foundation for future monetization (paid listings, bundles) without enforcing online dependencies.
- **Non-goals:**
  - Building a full SaaS storefront or payment processor.
  - Introducing cloud execution of skills.
  - Replacing local package managers for underlying OS dependencies.

## Detailed Design
### Architecture
1. **Registry Service (Phase 0):** Static artifact hosting (GitHub Releases + signed `index.json`).
   - Catalog published under `registry.loqa.ambiware.ai` (backed by GitHub Pages or S3).
   - Each release contains `skills.json` manifest referencing downloadable packages (tarballs) hosted on GitHub.
2. **Marketplace CLI/Host Integration:**
   - Extend `loqa-skill` CLI with `registry list/install/update` commands.
   - Runtime adds optional `skills.registry` configuration pointing at the catalog; operators run CLI or automation to sync.
3. **Submission Workflow:**
   - Creators open a PR to `loqa-marketplace` repo adding their package metadata.
   - CI validates the manifest against the v1 skills spec and verifies signatures before publishing to `index.json`.

Future phases may introduce a dedicated API or UI, but the MVP relies on static hosting for simplicity and offline mirroring.

### APIs / Interfaces
- **Catalog schema (`index.json`):**
  ```json
  {
    "version": 1,
    "generated_at": "2025-09-28T15:00:00Z",
    "skills": [
      {
        "name": "timer",
        "package": "https://github.com/loqalabs/loqa-skills/releases/download/v0.1.0/timer-0.1.0.tar.gz",
        "manifest": "sha256:...",
        "wasm": "sha256:...",
        "version": "0.1.0",
        "targets": ["linux/amd64", "darwin/arm64"],
        "tags": ["timers", "voice"],
        "author": "Loqa Labs",
        "description": "Simple countdown timer," 
        "license": "MIT",
        "signature": "sig:..."
      }
    ]
  }
  ```
- **Package layout (`.tar.gz`):**
  ```
  timer-0.1.0/
    skill.yaml
    build/timer.wasm
    README.md
    LICENSE
  ```
- **CLI additions:**
  - `loqa-skill registry list` – print catalog entries (with filtering by tag/author).
  - `loqa-skill registry install <name>` – download package, verify checksum/signature, unpack into skills directory.
  - `loqa-skill registry update <name>` – check catalog for newer versions.
  - CLI accepts `--registry URL` or reads `skills.registry.url` from config.

### Data Model
- `index.json` versioned and signed (CLI validates `sig` using Loqa Labs’s public key; future phases support publisher keys).
- Each skill package includes the canonical `skill.yaml`; versioning must match `metadata.version`.
- Optional metadata for paid/premium flag reserved for future use.

### Operational Considerations
- **Deployment:**
  - Initial catalog generated by GitHub Actions from `loqa-marketplace` repo.
  - Operators can mirror the static assets to an internal web server.
- **Observability:**
  - CLI emits structured logs; registry publishing workflow records metrics (e.g., packages, validation status) in GitHub Actions logs.
- **Security & Privacy:**
  - All packages signed; CLI refuses unsigned/unknown skills unless `--insecure` flag is set.
  - No runtime phone-home; installation is operator-triggered.
- **Performance:**
  - Static hosting keeps latency low; CLI caches downloaded artifacts under `~/.cache/loqa/registry`.

## Alternatives Considered
- **Direct Git repository installs:** Simple but lacks metadata normalization, signing, or curated catalog.
- **Full SaaS marketplace:** Overkill for MVP, adds cloud dependencies, and increases operational burden.
- **Peer-to-peer distribution:** Interesting for decentralization but complex for initial rollout.

## Backwards Compatibility
- Existing manual skill deployments continue working.
- Catalog/CLI features are opt-in; runtime changes limited to new configuration fields.
- Skill manifests remain v1-compatible; no breaking changes introduced.

## Open Questions
- [ ] Should the catalog support delta updates (ETag/If-None-Match) from day one?
- [ ] What signing mechanism should creators use for future community publishing (Sigstore vs. PGP)?
- [ ] How do we represent paid vs. free listings without implying payment processing in MVP?

## Implementation Plan
1. **Catalog Repository:**
   - Create `loqa-marketplace` repo with catalog generator workflow.
   - Seed with internal skills (timer, smart-home).
2. **CLI Enhancements:**
   - Implement registry commands in `loqa-skill`.
   - Add unit/integration tests using a local catalog fixture.
3. **Runtime Config:**
   - Extend `config/example.yaml` with `skills.registry` section.
   - Document installation flow in README and docs.
4. **Security:**
   - Generate Loqa Labs signing key pair; distribute public key with CLI.
   - Implement signature verification.
5. **Docs & Comms:**
   - Update authoring guide, site docs, and blog with marketplace instructions.

## References
- [Issue #26: Draft marketplace RFC](https://github.com/loqalabs/loqa-meta/issues/26)
- [docs/skills/SPEC.md](https://github.com/loqalabs/loqa-core/blob/main/docs/skills/SPEC.md)
- [loqa-core#37](https://github.com/loqalabs/loqa-core/issues/37) – skills spec evolution
- [Crates.io index design](https://doc.rust-lang.org/cargo/reference/registry-index.html)
- [VS Code extension marketplace format](https://code.visualstudio.com/api/working-with-extensions/publishing-extension)
